<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bingo BJ Numerical EV Engine</title>
    <style>
        body { font-family: sans-serif; max-width: 700px; margin: 20px auto; background: #1a1a1a; color: white; padding: 20px; }
        .container { background: #2d2d2d; padding: 25px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .input-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .input-group { flex: 1; }
        label { display: block; font-size: 0.8em; color: #aaa; margin-bottom: 5px; }
        select, input { width: 100%; padding: 10px; border-radius: 5px; border: none; background: #444; color: white; }
        button { width: 100%; padding: 15px; background: #70ad47; border: none; border-radius: 5px; color: white; font-weight: bold; cursor: pointer; margin-top: 10px; }
        #results { margin-top: 25px; border-top: 1px solid #444; padding-top: 20px; }
        .ev-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #3d3d3d; }
        .optimal { background: rgba(112, 173, 71, 0.2); border-left: 4px solid #70ad47; }
        .val { font-family: monospace; font-size: 1.1em; }
        .info { font-size: 0.8em; color: #888; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Bingo Blackjack EV Engine</h2>
        <p class="info">Rules: 8 Decks, S17, 20% Bingo Fee, Target Multiplier</p>

        <div class="input-row">
            <div class="input-group">
                <label>Multiplier</label>
                <select id="mult">
                    <option value="2">2x</option><option value="5">5x</option><option value="10" selected>10x</option>
                    <option value="25">25x</option><option value="50">50x</option><option value="100">100x</option>
                </select>
            </div>
            <div class="input-group">
                <label>Target Hand Value</label>
                <input type="number" id="target" value="16" min="12" max="21">
            </div>
        </div>

        <div class="input-row">
            <div class="input-group"><label>Player Card 1</label><input type="number" id="c1" value="10"></div>
            <div class="input-group"><label>Player Card 2</label><input type="number" id="c2" value="6"></div>
            <div class="input-group"><label>Dealer Upcard</label><input type="number" id="dealer" value="10"></div>
        </div>

        <button onclick="runEV()">Calculate Numerical EV</button>

        <div id="results"></div>
    </div>

<script>
    const deck = [4,4,4,4,4,4,4,4,16,4]; // Approximate 8-deck weights (2-9, 10s, Aces)
    
    function runEV() {
        const mult = parseFloat(document.getElementById('mult').value);
        const target = parseInt(document.getElementById('target').value);
        const pTotal = parseInt(document.getElementById('c1').value) + parseInt(document.getElementById('c2').value);
        const dUp = parseInt(document.getElementById('dealer').value);
        const fee = 0.20; // 20% Bingo Activator Fee

        // Dealer outcome probabilities based on upcard (Simplified S17 8-Deck model)
        const dProbs = getDealerProbs(dUp);

        // STAND EV calculation
        let standEV = calculateStandEV(pTotal, dProbs, mult, target);
        standEV -= fee; // Subtract fee from total return

        // HIT EV calculation (approximate 1-card hit for sub-hands)
        let hitEV = calculateHitEV(pTotal, dProbs, mult, target);
        hitEV -= fee;

        // SURRENDER EV
        const surrenderEV = -0.50 - fee; // Constant: Lose half bet + full fee

        displayResults([
            { name: 'Stand', ev: standEV },
            { name: 'Hit', ev: hitEV },
            { name: 'Surrender', ev: surrenderEV }
        ]);
    }

    function calculateStandEV(total, dProbs, mult, target) {
        if (total > 21) return -1.0;
        
        let ev = 0;
        const isBingo = (total === target);
        const winPay = isBingo ? mult : 1.0; // Payout is multiplied if total matches target

        // Win if dealer busts
        ev += dProbs.bust * winPay;
        
        // Compare values
        for (let dv = 17; dv <= 21; dv++) {
            if (total > dv) ev += dProbs[dv] * winPay;
            else if (total < dv) ev += dProbs[dv] * -1.0;
            // Pushes (total == dv) = 0 EV
        }
        return ev;
    }

    function calculateHitEV(total, dProbs, mult, target) {
        let ev = 0;
        for (let card = 1; card <= 10; card++) {
            let prob = (card === 10) ? 4/13 : 1/13;
            let newTotal = total + (card === 1 ? 11 : card);
            if (newTotal > 21 && card === 1) newTotal -= 10; // Ace logic
            
            if (newTotal > 21) ev += prob * -1.0;
            else ev += prob * calculateStandEV(newTotal, dProbs, mult, target);
        }
        return ev;
    }

    function getDealerProbs(upcard) {
        // Standard S17 Probs (Approx)
        const table = {
            2: { bust: .35, 17: .13, 18: .13, 19: .12, 20: .12, 21: .12 },
            10: { bust: .23, 17: .11, 18: .11, 19: .11, 20: .35, 21: .09 },
            11: { bust: .11, 17: .12, 18: .13, 19: .13, 20: .13, 21: .36 }
        };
        return table[upcard] || table[10];
    }

    function displayResults(actions) {
        const div = document.getElementById('results');
        div.innerHTML = '<h3>EV per $1.00 Wagered</h3>';
        
        actions.sort((a,b) => b.ev - a.ev);
        actions.forEach((a, i) => {
            const css = (i === 0) ? 'ev-item optimal' : 'ev-item';
            div.innerHTML += `<div class="${css}">
                <span>${a.name} ${i === 0 ? '(Optimal)' : ''}</span>
                <span class="val">${a.ev.toFixed(4)}</span>
            </div>`;
        });
    }
</script>
</body>
</html>
