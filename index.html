<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bingo Blackjack Recursive EV Engine</title>
    <style>
        body { font-family: sans-serif; background: #121212; color: #e0e0e0; max-width: 600px; margin: auto; padding: 20px; }
        .card { background: #1e1e1e; padding: 20px; border-radius: 12px; border: 1px solid #333; }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.8em; color: #888; margin-bottom: 5px; }
        input, select { width: 100%; padding: 10px; background: #2d2d2d; border: 1px solid #444; color: white; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: #70ad47; border: none; color: white; font-weight: bold; cursor: pointer; border-radius: 4px; margin-top: 10px; }
        .results { margin-top: 20px; padding-top: 20px; border-top: 1px solid #333; }
        .ev-row { display: flex; justify-content: space-between; padding: 8px; border-radius: 4px; }
        .optimal { background: rgba(112, 173, 71, 0.2); border-left: 4px solid #70ad47; font-weight: bold; }
        .val { font-family: monospace; }
    </style>
</head>
<body>

<div class="card">
    <h2>Bingo BJ Recursive Engine</h2>
    
    <div class="input-group">
        <label>Bingo Multiplier & Target</label>
        <div style="display: flex; gap: 10px;">
            <select id="mult">
                <option value="2">2x</option><option value="5">5x</option><option value="10">10x</option>
                <option value="25">25x</option><option value="50">50x</option><option value="100">100x</option>
            </select>
            <input type="number" id="target" value="21" placeholder="Target">
        </div>
    </div>

    <div class="input-group">
        <label>Current Player Cards (comma separated, e.g. 10,6)</label>
        <input type="text" id="playerCards" value="10,6">
    </div>

    <div class="input-group">
        <label>Dealer Upcard</label>
        <select id="dealer">
            <option value="2">2</option><option value="3">3</option><option value="4">4</option>
            <option value="5">5</option><option value="6">6</option><option value="7">7</option>
            <option value="8">8</option><option value="9">9</option><option value="10">10/Face</option>
            <option value="11">Ace</option>
        </select>
    </div>

    <button onclick="calculate()">Calculate Optimal Action</button>

    <div id="results" class="results" style="display:none;"></div>
</div>

<script>
// Wizard of Odds 8-Deck S17 Probabilities
const dealerProbs = {
    "2":  {"bust": 0.353, "17": 0.139, "18": 0.134, "19": 0.130, "20": 0.122, "21": 0.122},
    "3":  {"bust": 0.374, "17": 0.135, "18": 0.131, "19": 0.125, "20": 0.122, "21": 0.114},
    "4":  {"bust": 0.403, "17": 0.131, "18": 0.120, "19": 0.120, "20": 0.116, "21": 0.110},
    "5":  {"bust": 0.429, "17": 0.122, "18": 0.122, "19": 0.117, "20": 0.109, "21": 0.101},
    "6":  {"bust": 0.439, "17": 0.165, "18": 0.106, "19": 0.106, "20": 0.101, "21": 0.083},
    "7":  {"bust": 0.262, "17": 0.369, "18": 0.138, "19": 0.079, "20": 0.079, "21": 0.073},
    "8":  {"bust": 0.245, "17": 0.129, "18": 0.359, "19": 0.129, "20": 0.069, "21": 0.069},
    "9":  {"bust": 0.233, "17": 0.120, "18": 0.102, "19": 0.355, "20": 0.120, "21": 0.061},
    "10": {"bust": 0.214, "17": 0.113, "18": 0.102, "19": 0.102, "20": 0.354, "21": 0.115},
    "11": {"bust": 0.155, "17": 0.131, "18": 0.131, "19": 0.131, "20": 0.131, "21": 0.321}
};

function getSoftTotal(cards) {
    let total = cards.reduce((a, b) => a + b, 0);
    let aceCount = cards.filter(c => c === 11).length;
    while (total > 21 && aceCount > 0) {
        total -= 10;
        aceCount--;
    }
    return total;
}

function getStandEV(total, upcard, mult, target) {
    if (total > 21) return -1.0;
    const d = dealerProbs[upcard];
    const winPay = (total === target) ? mult : 1.0;
    let ev = d.bust * winPay;
    for (let i = 17; i <= 21; i++) {
        if (total > i) ev += d[i] * winPay;
        else if (total < i) ev += d[i] * -1.0;
    }
    return ev;
}

// Recursive Hit Function: Returns max(Stand EV, Hit EV)
function getBestActionEV(cards, upcard, mult, target) {
    const total = getSoftTotal(cards);
    if (total >= 21) return getStandEV(total, upcard, mult, target);

    const standEV = getStandEV(total, upcard, mult, target);
    
    let hitEV = 0;
    for (let card = 2; card <= 11; card++) {
        const weight = (card === 10) ? 4/13 : 1/13;
        const nextCards = [...cards, card];
        const nextTotal = getSoftTotal(nextCards);
        
        if (nextTotal > 21) {
            hitEV += weight * -1.0;
        } else {
            // Recurse: What's the best move after drawing this card?
            hitEV += weight * getBestActionEV(nextCards, upcard, mult, target);
        }
    }
    return Math.max(standEV, hitEV);
}

function calculate() {
    const mult = parseFloat(document.getElementById('mult').value);
    const target = parseInt(document.getElementById('target').value);
    const cards = document.getElementById('playerCards').value.split(',').map(Number);
    const upcard = document.getElementById('dealer').value;
    const fee = 0.20;

    const currentTotal = getSoftTotal(cards);
    const standEV = getStandEV(currentTotal, upcard, mult, target) - fee;
    
    // Calculate Hit EV by looking at the expected outcome of drawing one card 
    // and then playing optimally from there.
    let hitEV = 0;
    for (let card = 2; card <= 11; card++) {
        const weight = (card === 10) ? 4/13 : 1/13;
        hitEV += weight * getBestActionEV([...cards, card], upcard, mult, target);
    }
    hitEV -= fee;

    const surrenderEV = -0.50 - fee;

    // Display
    const res = document.getElementById('results');
    res.style.display = 'block';
    const evs = [
        { name: "Stand", val: standEV },
        { name: "Hit", val: hitEV },
        { name: "Surrender", val: surrenderEV }
    ];
    evs.sort((a,b) => b.val - a.val);

    res.innerHTML = evs.map((e, i) => `
        <div class="ev-row ${i === 0 ? 'optimal' : ''}">
            <span>${e.name}</span>
            <span class="val">${e.val.toFixed(4)}</span>
        </div>
    `).join('');
}
</script>
</body>
</html>
